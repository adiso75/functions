kind: job
metadata:
  name: run-sql
  tag: ''
  hash: fd6946d7aa699b57d51d2827ae239e1ba5c2a290
  project: ''
  labels:
    author: adih
  categories:
  - data-prep
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  default_handler: ''
  entry_points:
    sql:
      name: sql
      doc: ''
      parameters:
      - name: context
      - name: sql_query
      - name: database_url
      outputs: []
      lineno: 10
  description: Running SQL using presto and store it as a csv file
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTA2LTE1IDE5OjAwCgppbXBvcnQgcGFuZGFzIGFzIHBkIApmcm9tIG9zIGltcG9ydCBwYXRoCmltcG9ydCBweWhpdmUKaW1wb3J0IHRpbWUKaW1wb3J0IGRhdGV0aW1lCmZyb20gc3FsYWxjaGVteS5lbmdpbmUgaW1wb3J0IGNyZWF0ZV9lbmdpbmUgCgpkZWYgc3FsKGNvbnRleHQsIHNxbF9xdWVyeSwgZGF0YWJhc2VfdXJsKToKICAgICAgCiAgICB0YXJnZXRfcGF0aCA9IHBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsICdkYXRhJykKICAgIGVuZ2luZSA9IGNyZWF0ZV9lbmdpbmUgKGRhdGFiYXNlX3VybCkKICAgIGRmID0gcGQucmVhZF9zcWwoc3FsX3F1ZXJ5LGVuZ2luZSkKICAgICAKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoJ3F1ZXJ5IHJlc3VsdCcsIGRmPWRmLCBhcnRpZmFjdF9wYXRoPXRhcmdldF9wYXRoKQoK
    commands:
    - pip install pandas==1.0.1
    - pip install --no-cache-dir git+https://github.com/v3io/PyHive.git@v0.6.999
    - pip install requests==2.23.0
    - pip install sqlalchemy==1.3.11
    - pip install PyMySQL==0.9.3
    code_origin: run_sql.ipynb
